{% extends 'users/base.html' %}

{% block content %}

    <form method="post" class="text-center">
        {% csrf_token %}

        {{ form }}

        <button type="submit" class="btn btn-primary btn-lg center-block mt-3 mb-5 w-25">Filter</button>
    </form>




    <h1 class="text-center">Analytics Main Page</h1>



    <div class="bd-example">
        {#TODO: allow multiple expanded chart#}
        {#TODO: add toggle all button#}
        {#TODO: add expoer functinality#}
        {#TODO: enhance styling#}
        <div class="accordion" id="accordionExample">



        </div>

    </div>

    </div>

    <!-- Displaying these here for now.. -->
    <h3>Donation Count Bar Chart With Quantity</h3>
    <div style="width:100%; height:55%;">
        <canvas id="bar-chart-1" width="350" height="100"></canvas>
    </div>

    <h3>Donation Count Bar Chart</h3>
    <div style="width:100%; height:25%;">
        <canvas id="bar-chart-2" width="350" height="100"></canvas>
    </div>


    <h3>Donation Count Pie Chart</h3>
    <div style="width:100%; height:100%;">
        <canvas id="pie-chart" width="500" height="500"></canvas>
    </div>



<script>

    let months = ['January', 'February', 'March', 'April', 'May', 'June', 'July','August','September','October','November','December'];

    $.ajax({
        url: 'get_donation_count_date_qty/',
        datatype: 'json',
        type: 'GET',
        success: function (response) {
            console.log('Donations W/ quantity (bar chart 1):', response);

            var ctx = document.getElementById('bar-chart-1').getContext('2d');
            var chart = new Chart(ctx, {

                type: 'bar',

                // The data for our dataset
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Funds',
                        backgroundColor: "#3e95cd",
                        borderColor: "#3e95cd",
                        data: response["funds_table"]
                    },{
                        label: 'Gift Cards',
                        backgroundColor: "#8e5ea2",
                        borderColor: "#8e5ea2",
                        data: response["giftcards_table"]
                    },{
                        label: 'Clothing',
                        backgroundColor: "#3cba9f",
                        borderColor: "#3cba9f",
                        data: response["clothing_table"]
                    },{
                        label: 'Food',
                        backgroundColor: "#e8c3b9",
                        borderColor: "#e8c3b9",
                        data: response["foods_table"]
                    },{
                        label: 'Miscellaneous',
                        backgroundColor: "#c45850",
                        borderColor: "#c45850",
                        data: response["misc_table"]
                    }]
                },
                options: {}
            });

        }
    });



    $.ajax({
        url: 'get_donation_count_month/',
        datatype: 'json',
        type: 'GET',
        success: function (response) {

            console.log('Donations W/O quantity: (bar chart 2)', response);


            var ctx = document.getElementById('bar-chart-2').getContext('2d');
            var chart = new Chart(ctx, {

                type: 'bar',

                // The data for our dataset
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Funds',
                        backgroundColor: "#3e95cd",
                        borderColor: "#3e95cd",
                        data: response["funds_table"]
                    },{
                        label: 'Gift Cards',
                        backgroundColor: "#8e5ea2",
                        borderColor: "#8e5ea2",
                        data: response["giftcards_table"]
                    },{
                        label: 'Clothing',
                        backgroundColor: "#3cba9f",
                        borderColor: "#3cba9f",
                        data: response["clothing_table"]
                    },{
                        label: 'Food',
                        backgroundColor: "#e8c3b9",
                        borderColor: "#e8c3b9",
                        data: response["foods_table"]
                    },{
                        label: 'Miscellaneous',
                        backgroundColor: "#c45850",
                        borderColor: "#c45850",
                        data: response["misc_table"]
                    }]
                },
                options: {}
            });
        }
    });



    $.ajax({
        url: 'get_donation_item_count/',
        datatype: 'json',
        type: 'GET',
        success: function (response) {
            console.log('Total donations by category (pie chart):', response);

            var ctx = document.getElementById('pie-chart').getContext('2d');
            var myChart = new Chart(ctx, {
            type: 'pie',
            data: {

                <!-- Donation Categories -->
                labels: ['Funds', 'Gift Cards', 'Clothing', 'Food', 'Miscellaneous'],
                datasets: [{
                    label: '# of Votes',

                    <!-- Donation Category Counts -->
                    data: [response["funds_table"], response["giftcards_table"], response["clothing_table"],response["foods_table"], response["misc_table"]],

                    backgroundColor: [
                        "#3e95cd",
                        "#8e5ea2",
                        "#3cba9f",
                        "#e8c3b9",
                        "#c45850",
                    ],
                    borderColor: [
                        "#3e95cd",
                        "#8e5ea2",
                        "#3cba9f",
                        "#e8c3b9",
                        "#c45850",
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,

                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }
        });

        }
    });

</script>


{% endblock %}

